{"version":3,"sources":["../../src/sdk/common/service.ts"],"sourcesContent":["import { Subscription } from 'rxjs';\nimport { Context } from '../context.js';\n\nexport abstract class Service {\n  protected context: Context;\n  private inited = false;\n  private destroyed = false;\n  private attachedCounter = 0;\n  private subscriptions: Subscription[] = [];\n\n  init(context: Context): void {\n    if (!this.inited) {\n      this.inited = true;\n      this.context = context;\n\n      if (this.onInit) {\n        this.onInit();\n      }\n\n      if (this.error$) {\n        this.addSubscriptions(this.error$.subscribe());\n      }\n    }\n\n    ++this.attachedCounter;\n  }\n\n  destroy(): void {\n    if (!this.attachedCounter) {\n      return;\n    }\n\n    --this.attachedCounter;\n\n    if (!this.attachedCounter && !this.destroyed) {\n      this.destroyed = true;\n\n      this.removeSubscriptions();\n\n      if (this.onDestroy) {\n        this.onDestroy();\n      }\n    }\n  }\n\n  protected onInit?(): void;\n\n  protected onDestroy?(): void;\n\n  protected get error$(): Context['error$'] {\n    return this.context.error$;\n  }\n\n  protected get services(): Context['services'] {\n    return this.context.services;\n  }\n\n  protected addSubscriptions(...subscriptions: Subscription[]): void {\n    this.subscriptions.push(...subscriptions.filter((subscription) => !!subscription));\n  }\n\n  protected removeSubscriptions(): void {\n    for (const subscription of this.subscriptions) {\n      subscription.unsubscribe();\n    }\n    this.subscriptions = [];\n  }\n\n  protected replaceSubscriptions(...subscriptions: Subscription[]): void {\n    this.removeSubscriptions();\n    this.addSubscriptions(...subscriptions);\n  }\n}\n"],"mappings":";AAGO,IAAe,UAAf,MAAuB;AAAA,EAAvB;AAEL,SAAQ,SAAS;AACjB,SAAQ,YAAY;AACpB,SAAQ,kBAAkB;AAC1B,SAAQ,gBAAgC,CAAC;AAAA;AAAA,EAEzC,KAAK,SAAwB;AAC3B,QAAI,CAAC,KAAK,QAAQ;AAChB,WAAK,SAAS;AACd,WAAK,UAAU;AAEf,UAAI,KAAK,QAAQ;AACf,aAAK,OAAO;AAAA,MACd;AAEA,UAAI,KAAK,QAAQ;AACf,aAAK,iBAAiB,KAAK,OAAO,UAAU,CAAC;AAAA,MAC/C;AAAA,IACF;AAEA,MAAE,KAAK;AAAA,EACT;AAAA,EAEA,UAAgB;AACd,QAAI,CAAC,KAAK,iBAAiB;AACzB;AAAA,IACF;AAEA,MAAE,KAAK;AAEP,QAAI,CAAC,KAAK,mBAAmB,CAAC,KAAK,WAAW;AAC5C,WAAK,YAAY;AAEjB,WAAK,oBAAoB;AAEzB,UAAI,KAAK,WAAW;AAClB,aAAK,UAAU;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AAAA,EAMA,IAAc,SAA4B;AACxC,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,IAAc,WAAgC;AAC5C,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEU,oBAAoB,eAAqC;AACjE,SAAK,cAAc,KAAK,GAAG,cAAc,OAAO,CAAC,iBAAiB,CAAC,CAAC,YAAY,CAAC;AAAA,EACnF;AAAA,EAEU,sBAA4B;AACpC,eAAW,gBAAgB,KAAK,eAAe;AAC7C,mBAAa,YAAY;AAAA,IAC3B;AACA,SAAK,gBAAgB,CAAC;AAAA,EACxB;AAAA,EAEU,wBAAwB,eAAqC;AACrE,SAAK,oBAAoB;AACzB,SAAK,iBAAiB,GAAG,aAAa;AAAA,EACxC;AACF;","names":[]}